<!DOCTYPE html>
<html>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=VT323&display=swap");

    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
  </style>

  <body>
    <div id="panel">
      Width:
      <input type="number" value="6" placeholder="Width" id="canvas-width" />
      Height:
      <input type="number" value="" placeholder="Height" id="canvas-height" />
      Role Size:
      <input type="number" value="40" placeholder="Role Size" id="role-size" />
      Description Size:
      <input
        type="number"
        value="20"
        placeholder="Description Size"
        id="description-size"
      />
    </div>

    <div style="display: none">
      <img
        id="img"
        src="./Grey-Among-Us-clipart-transparent.png"
        alt="Among Us"
      />
    </div>

    <canvas
      id="myCanvas"
      width="3000"
      height="2000"
      style="border: 1px solid #d3d3d3"
    >
      Your browser does not support the HTML canvas tag.
    </canvas>

    <script src="./roles.js"></script>
    <script>
      // global variables
      const width = document.querySelector("#canvas-width");
      const height = document.querySelector("#canvas-height");
      const role_S = document.querySelector("#role-size");
      const desc_S = document.querySelector("#description-size");

      /**
       * writes text in different colors
       * https://mrcoles.com/multi-colored-text-canvas/
       */
      function fillMixedText(ctx, args, x, y) {
        let defaultFillStyle = ctx.fillStyle;
        let defaultFont = ctx.font;

        ctx.save();
        args.forEach(({ text, fillStyle, font }) => {
          // 'hacky' way to avoid blank space for ImpLover
          if (text !== "IMP") text = text + " ";

          ctx.fillStyle = fillStyle || defaultFillStyle;
          ctx.font = font || defaultFont;
          ctx.fillText(text, x, y);
          x += ctx.measureText(text).width;
        });
        ctx.restore();
      }

      function drawRole(ctx, { name, desc, color }, i) {
        const x = i % width.value;
        const y = Math.floor(i / width.value);

        /**
         * BACKGROUND
         */
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.rect(x * 300, y * 200, 300, 200);
        ctx.fill();

        // ctx.textAlign = "center";

        /**
         * ROLE TEXT
         */
        fillMixedText(
          ctx,
          name.split(" ").map((word) => {
            return {
              text: word
                .replace(/<(#[a-zA-Z0-9]{6})>([a-zA-Z]*)<\/>/, "$2")
                .toUpperCase(),
              fillStyle: word.includes("</>")
                ? word.replace(/<(#[a-zA-Z0-9]{6})>([a-zA-Z]*)<\/>/, "$1")
                : color,
              font: `${role_S.value}px VT323`,
            };
          }),
          x * 300 + 150,
          y * 200 + 40
        );

        // ctx.fillStyle = color;
        // ctx.font = `${role_S.value}px VT323`;
        // ctx.fillText(name.toUpperCase(), x * 300 + 150, y * 200 + 40);

        /**
         * DESCRIPTION TEXT
         */
        fillMixedText(
          ctx,
          desc.split(" ").map((word) => {
            return {
              text: word
                .replace(/<(#[a-zA-Z0-9]{6})>([a-zA-Z]*)<\/>/, "$2")
                .toUpperCase(),
              fillStyle: word.includes("</>")
                ? word.replace(/<(#[a-zA-Z0-9]{6})>([a-zA-Z]*)<\/>/, "$1")
                : "white",
              font: `${desc_S.value}px VT323`,
            };
          }),
          x * 300 + 150,
          y * 200 + 60
        );

        // ctx.fillStyle = "white";
        // ctx.font = `${desc_S.value}px VT323`;
        // ctx.fillText(
        //   desc.toUpperCase(),
        //   x * 300 + 150,
        //   y * 200 + 60
        // );

        /**
         * ELLIPSE
         */
        ctx.fillStyle = color;
        ctx.filter = "blur(10px)";
        ctx.beginPath();
        ctx.ellipse(
          x * 300 + 150,
          y * 200 + 130,
          40,
          200,
          (1 / 2) * Math.PI,
          0,
          2 * Math.PI
        );
        ctx.fill();

        /**
         * AMONG US FIGURE
         */
        ctx.filter = "blur(0px)";
        const image = document.getElementById("img");
        ctx.drawImage(image, x * 300 + 120, y * 200 + 100, 70, 90);
      }

      function start() {
        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");

        c.width = width.value * 300;
        c.height = height.value * 200;

        ctx.clearRect(0, 0, c.width, c.height);

        roles.forEach((role, i) => {
          drawRole(ctx, role, i);
        });
      }

      window.onload = () => {
        height.value = Math.ceil(roles.length / width.value);
        start();
      };

      /**
       * EVENT LISTENERS
       */
      width.addEventListener("change", () => {
        height.value = Math.ceil(roles.length / width.value);
        start();
      });
      height.addEventListener("change", () => {
        width.value = Math.ceil(roles.length / height.value);
        start();
      });
      role_S.addEventListener("change", () => {
        start();
      });
      desc_S.addEventListener("change", () => {
        start();
      });
    </script>
  </body>
</html>
